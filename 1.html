<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Daily Turnover Challenge Leaderboard</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
/* --- 2. CSS STYLES ARE INCLUDED HERE ---
    (See the separate CSS block below for clarity)
*/
        /* CSS Variables: CYBER-ROYAL / MYSTIC PINK THEME */
        :root {
            --color-dark-bg: #140808; 
            --color-card-bg: #291a1a; 
            --color-control-bar: #3c2a2a; 
            --color-header-bg: rgba(20, 8, 8, 0.95);
            
            --color-accent-gold: #FFC300; 
            --color-accent-pink: #FF6EC4; /* The requested pink color */
            --color-text-light: #F0F0F0;
            --color-text-muted: #A0A0A0;
            
            --color-podium-1: #FFD700;
            --color-podium-2: #B0B0B0;
            --color-podium-3: #964B00;
        }

        /* Base Styles and Layout */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--color-dark-bg);
            color: var(--color-text-light);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            background: linear-gradient(to bottom, #301010 0%, var(--color-dark-bg) 60%);
            background-size: cover;
            padding-top: 20px;
        }
        
        /* General Component Styles */
        .flag-icon { width: 20px; height: 14px; border-radius: 3px; border: 1px solid rgba(255, 255, 255, 0.3); object-fit: cover; }
        .avatar-podium { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 4px solid; box-shadow: 0 0 10px rgba(0, 0, 0, 0.7); z-index: 10;}
        .avatar-list { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; border: 2px solid var(--color-accent-pink); } 


        .leaderboard-wrapper {
            width: 100%;
            max-width: 480px; 
            background: var(--color-card-bg);
            border: 2px solid var(--color-accent-pink); /* PINK BORDER */
            box-shadow: 0 0 25px rgba(255, 110, 196, 0.6); 
            margin: 0 auto 40px; 
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        /* HEADER & NAVIGATION */
        .global-header-block { padding: 15px 15px 8px; text-align: center; background-color: var(--color-control-bar); border-bottom: 2px solid var(--color-accent-pink); }
        .global-header-block h1 { font-family: 'Cinzel', serif; font-size: 1.8rem; font-weight: 900; margin: 0; text-transform: uppercase; color: var(--color-accent-gold); text-shadow: 0 0 8px rgba(255, 195, 0, 0.6), 0 1px 0 #333; }
        .global-header-block .description { font-size: 0.9rem; margin-top: 5px; margin-bottom: 10px; }
        
        .date-selector-group input[type="date"] { background-color: #583e3e; color: var(--color-text-light); border: 1px solid var(--color-accent-pink); padding: 6px 8px; border-radius: 5px; font-size: 0.8rem; }
        
        header { padding: 0 15px 0; position: sticky; top: 0; z-index: 100; background-color: var(--color-header-bg); border-bottom: 1px solid var(--color-accent-pink); }
        .header-nav { display: flex; justify-content: space-around; padding: 10px 0; }
        .nav-item { color: var(--color-text-muted); padding: 5px 10px; position: relative; cursor: pointer; transition: color 0.2s; font-size: 0.9rem; }
        .nav-item.active { color: var(--color-accent-gold); text-shadow: 0 0 5px rgba(255, 195, 0, 0.8); }
        .nav-item.active::after { content: ''; position: absolute; bottom: -1px; left: 50%; transform: translateX(-50%); width: 80%; height: 3px; background-color: var(--color-accent-gold); box-shadow: 0 0 5px var(--color-accent-gold); border-radius: 2px; }

        .language-switcher { position: fixed; top: 5px; right: 5px; z-index: 200; display: flex; align-items: center; gap: 5px; background-color: rgba(60, 42, 42, 0.8); padding: 3px 6px; border-radius: 6px; border: 1px solid var(--color-accent-pink); }
        .language-switcher .fa-globe { color: var(--color-accent-pink); }
        .language-switcher select { background: transparent; border: none; color: var(--color-text-light); font-size: 0.7rem; }


        /* PODIUM SECTION */
        .podium-section { padding: 20px 15px 40px; background: linear-gradient(to bottom, var(--color-card-bg), var(--color-dark-bg)); position: relative; z-index: 1; }
        .podium-bars { display: flex; justify-content: center; align-items: flex-end; height: 220px; gap: 10px; }
        .podium-bar { flex-grow: 1; position: relative; display: flex; flex-direction: column; align-items: center; }
        .podium-bar-inner { width: 90%; background-color: rgba(41, 26, 26, 0.7); border-radius: 5px 5px 0 0; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s; }
        .podium-bar[data-rank="1"] .podium-bar-inner { height: 160px; background-color: rgba(255, 215, 0, 0.15); box-shadow: inset 0 0 15px var(--color-podium-1); }
        .podium-bar[data-rank="2"] .podium-bar-inner { height: 120px; background-color: rgba(176, 176, 176, 0.15); box-shadow: inset 0 0 15px var(--color-podium-2); }
        .podium-bar[data-rank="3"] .podium-bar-inner { height: 80px; background-color: rgba(150, 75, 0, 0.15); box-shadow: inset 0 0 15px var(--color-podium-3); }

        .podium-bar[data-rank="1"] .avatar-podium { border-color: var(--color-podium-1); }
        .podium-bar[data-rank="2"] .avatar-podium { border-color: var(--color-podium-2); }
        .podium-bar[data-rank="3"] .avatar-podium { border-color: var(--color-podium-3); }

        .podium-details { position: absolute; top: -50px; display: flex; flex-direction: column; align-items: center; width: 100%; text-align: center; }
        .trophy { color: var(--color-accent-gold); font-size: 1.2rem; margin-bottom: 5px; text-shadow: 0 0 5px var(--color-accent-gold); }
        .podium-name-flag { display: flex; align-items: center; gap: 5px; margin-top: 3px; }
        .name-podium { font-size: 0.8rem; font-weight: 700; color: var(--color-text-light); }
        .podium-metrics { background-color: var(--color-control-bar); padding: 3px 6px; border-radius: 5px; margin-top: 5px; border: 1px solid var(--color-accent-pink); }
        .podium-turnover { font-size: 0.75rem; color: var(--color-accent-gold); font-weight: 700; margin-right: 5px; }
        .podium-prize { font-size: 0.8rem; color: var(--color-accent-pink); font-weight: 700; text-shadow: 0 0 5px rgba(255, 110, 196, 0.5); }
        .podium-bar.highlight-row { box-shadow: 0 0 20px 5px rgba(255, 110, 196, 0.9), inset 0 0 10px rgba(255, 110, 196, 0.5); border: 2px solid var(--color-accent-pink); }


        /* CONTROLS & SEARCH */
        .controls-bar { padding: 10px 15px 15px; background-color: var(--color-control-bar); border-top: 2px solid var(--color-accent-pink); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5); display: flex; flex-direction: column; gap: 10px; }
        .countdown-timer-group { display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; }
        .countdown-box { display: flex; flex-direction: column; align-items: flex-start; }
        .countdown-label { color: var(--color-text-muted); margin-bottom: 2px; }
        .countdown-time { font-family: 'Cinzel', serif; font-size: 1.5rem; font-weight: 700; color: var(--color-accent-pink); letter-spacing: 2px; text-shadow: 0 0 10px rgba(255, 110, 196, 0.8); }
        .update-timer { padding: 5px 8px; background-color: #583e3e; border-radius: 6px; border: 1px solid var(--color-accent-pink); display: flex; align-items: center; gap: 5px; font-size: 0.8rem; }
        .update-timer .fa-sync-alt { color: var(--color-accent-pink); }
        .search-group input { width: 100%; padding: 10px 12px; background-color: #4a3333; border: 1px solid var(--color-accent-pink); color: var(--color-text-light); border-radius: 8px; box-sizing: border-box; font-size: 0.9rem; transition: border-color 0.3s, box-shadow 0.3s; }
        .search-group input:focus { border-color: var(--color-accent-gold); box-shadow: 0 0 5px rgba(255, 110, 196, 0.8); outline: none; }
        #searchMessage { text-align: center; padding: 8px; background-color: rgba(255, 110, 196, 0.3); color: var(--color-accent-gold); border: 1px solid var(--color-accent-pink); border-radius: 6px; margin-top: 8px; display: none; font-size: 0.9rem; }


        /* LIST SECTION (Ranks 4+) */
        .list-section { padding: 8px 10px; }
        .list-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 8px; background-color: rgba(0, 0, 0, 0.2); border-left: 5px solid var(--color-card-bg); border-radius: 4px; margin-bottom: 6px; transition: all 0.3s; }
        .list-item:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 110, 196, 0.3); border-left-color: var(--color-accent-pink); cursor: pointer; }
        .list-item.highlight-row { border: 2px solid var(--color-accent-gold); box-shadow: 0 0 15px rgba(255, 110, 196, 0.7); border-left-color: var(--color-accent-pink); }
        .list-rank { width: 30px; text-align: center; font-size: 1rem; font-weight: 700; color: var(--color-accent-pink); font-family: 'Cinzel', serif; }
        .list-player-info { display: flex; align-items: center; gap: 8px; flex-grow: 1; }
        .list-name-flag { display: flex; flex-direction: column; align-items: flex-start; gap: 2px; }
        .list-name { font-size: 0.9rem; font-weight: 700; }
        .list-turnover { font-size: 0.8rem; font-weight: 700; color: var(--color-accent-gold); width: 90px; text-align: right; }
        .list-prize { font-size: 0.8rem; color: var(--color-accent-pink); font-weight: 700; width: 70px; text-align: right; }


        /* FOOTER & CTAS */
        .cta-section { text-align: center; padding: 15px 15px 30px; background-color: var(--color-control-bar); border-top: 2px solid var(--color-accent-pink); }
        .cta-buttons { display: flex; justify-content: center; gap: 10px; }
        .cta-button { text-decoration: none; padding: 10px 20px; border-radius: 25px; font-weight: 700; transition: all 0.3s; cursor: pointer; border: none; font-size: 0.9rem; }
        .cta-primary { background-color: var(--color-accent-gold); color: var(--color-dark-bg); box-shadow: 0 0 10px rgba(255, 195, 0, 0.7); }
        .cta-primary:hover { background-color: #E6B800; transform: scale(1.05); }
        .cta-secondary { background-color: transparent; color: var(--color-accent-pink); border: 2px solid var(--color-accent-pink); box-shadow: 0 0 8px rgba(255, 110, 196, 0.5); }
        .cta-secondary:hover { background-color: rgba(255, 110, 196, 0.1); transform: scale(1.05); }
        .event-running-text { margin-top: 15px; font-size: 0.75rem; color: var(--color-text-muted); }


        /* MODAL STYLES */
        .modal-backdrop { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); }
        .modal-content { background-color: #382828; margin: 2% auto; padding: 20px; border: 2px solid var(--color-accent-pink); border-radius: 15px; width: 90%; max-width: 800px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5); position: relative; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-accent-pink); padding-bottom: 10px; margin-bottom: 15px; }
        .modal-title { color: var(--color-accent-pink); font-size: 1.5rem; margin: 0; }
        .modal-header h3 { color: var(--color-accent-pink) !important; font-size: 1.1rem; margin-top: 15px; }
        
        .faq-item { margin-bottom: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding-bottom: 5px; font-size: 0.9rem; }
        .faq-question { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 8px 0; font-weight: 700; color: var(--color-text-light); }
        .faq-question i { transition: transform 0.3s; color: var(--color-accent-pink); }
        .faq-question.active i { transform: rotate(180deg); color: var(--color-accent-gold); }
        .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; background-color: rgba(255, 255, 255, 0.05); padding: 0 10px; border-radius: 5px; font-size: 0.85rem; }
        .faq-answer.open { max-height: 500px; padding: 10px; transition: max-height 0.5s ease-in; }


        /* RESPONSIVENESS (Desktop Optimization) */
        @media (min-width: 600px) {
             body { padding-top: 40px; background: linear-gradient(to right, #100505, var(--color-dark-bg) 20%, var(--color-dark-bg) 80%, #100505); }
            .leaderboard-wrapper { max-width: 600px; border-width: 3px; }
            .global-header-block { padding: 25px 20px 15px; }
            .global-header-block h1 { font-size: 2.2rem; }
            .global-header-block .description { font-size: 1rem; }
            .podium-section { padding: 40px 30px 60px; }
            .podium-bars { height: 280px; gap: 20px; }
            .podium-bar[data-rank="1"] .podium-bar-inner { height: 200px; }
            .podium-bar[data-rank="2"] .podium-bar-inner { height: 160px; }
            .podium-bar[data-rank="3"] .podium-bar-inner { height: 120px; }
            .avatar-podium { width: 90px; height: 90px; } 
            .podium-details { top: -60px; }
            .list-section { padding: 15px 20px; }
            .list-item { padding: 15px 10px; }
            .list-rank { font-size: 1.3rem; }
            .list-name { font-size: 1rem; }
            .list-turnover { font-size: 0.9rem; width: 120px; }
            .list-prize { font-size: 0.9rem; width: 90px; }
            .countdown-time { font-size: 2rem; }
            .search-group input { padding: 14px 15px; }
            .cta-button { padding: 15px 30px; font-size: 1rem; }
        }

    </style>
</head>
<body>

    <div class="leaderboard-wrapper">
        
        <div class="global-header-block">
            <h1 id="headerTitle">DAILY TURNOVER CHALLENGE</h1>
            <p class="description" data-translate="description">Challenge and win up to USD100 every day!</p>
            
            <div class="date-selector-group">
                <input type="date" id="leaderboardDate" onchange="fetchDataForDate(this.value)">
            </div>
        </div>

        <header>
            <div class="language-switcher">
                <i class="fas fa-globe"></i>
                <select id="languageSelect" onchange="setLanguage(this.value)">
                    <option value="en">EN</option>
                    <option value="pt">PT</option>
                    <option value="es">ES</option>
                </select>
            </div>
            
            <div class="header-nav">
                <div class="nav-item">CHARM</div>
                <div class="nav-item active">REGAL</div>
                <div class="nav-item">CLOSE</div>
            </div>
        </header>

        <div class="podium-section">
            <div class="podium-bars">
                
                <div class="podium-bar" data-rank="2" id="rank2">
                    <div class="podium-details">
                        <i class="fas fa-trophy trophy"></i>
                        <img id="avatar-2" class="avatar-podium" alt="Player 2 Avatar">
                        
                        <div class="podium-name-flag">
                             <img id="flag-2" class="flag-icon" alt="Flag">
                             <div class="name-podium" id="name-2"></div>
                        </div>

                        <div class="podium-metrics">
                            <span class="podium-turnover"><i class="fas fa-coin"></i> <span id="turnover-2"></span></span>
                            <div class="podium-prize" id="prize-2"></div>
                        </div>
                    </div>
                    <div class="podium-bar-inner"></div>
                </div>

                <div class="podium-bar" data-rank="1" id="rank1">
                    <div class="podium-details">
                        <i class="fas fa-trophy trophy"></i>
                        <img id="avatar-1" class="avatar-podium" alt="Player 1 Avatar">
                        
                        <div class="podium-name-flag">
                             <img id="flag-1" class="flag-icon" alt="Flag">
                             <div class="name-podium" id="name-1"></div>
                        </div>

                        <div class="podium-metrics">
                            <span class="podium-turnover"><i class="fas fa-coin"></i> <span id="turnover-1"></span></span>
                            <div class="podium-prize" id="prize-1"></div>
                        </div>
                    </div>
                    <div class="podium-bar-inner"></div>
                </div>

                <div class="podium-bar" data-rank="3" id="rank3">
                    <div class="podium-details">
                        <i class="fas fa-trophy trophy"></i>
                        <img id="avatar-3" class="avatar-podium" alt="Player 3 Avatar">
                        
                        <div class="podium-name-flag">
                             <img id="flag-3" class="flag-icon" alt="Flag">
                             <div class="name-podium" id="name-3"></div>
                        </div>

                        <div class="podium-metrics">
                            <span class="podium-turnover"><i class="fas fa-coin"></i> <span id="turnover-3"></span></span>
                            <div class="podium-prize" id="prize-3"></div>
                        </div>
                    </div>
                    <div class="podium-bar-inner"></div>
                </div>

            </div>
        </div>
        
        <div class="controls-bar">
            <div class="countdown-timer-group">
                <div class="countdown-box">
                    <span class="countdown-label" data-translate="payoutLabel">Next Rewards Payout in:</span>
                    <span class="countdown-time" id="payout-timer">00:00:00</span>
                </div>
                <div class="update-timer">
                    <i class="fas fa-sync-alt"></i>
                    <span id="update-countdown" data-translate="refreshLabel">Data Refresh in: 30:00</span>
                </div>
            </div>
            <div class="search-group">
                <input type="text" id="usernameSearch" data-translate-placeholder="searchUsername" placeholder="Search Username" onkeyup="filterLeaderboard()">
            </div>
            <div id="searchMessage"></div>
        </div>
        
        <div class="list-section">
            <div id="leaderboardList">
                </div>
        </div>
        
        <footer class="cta-section">
            <div class="cta-buttons">
                <a href="#" class="cta-button cta-primary" data-translate="ctaPlay">Start Playing</a>
                <button class="cta-button cta-secondary" onclick="openModal()" data-translate="ctaHowItWorks">How It Works (FAQ & T&C)</button>
            </div>
            <p class="event-running-text" data-translate="eventRunning">Event Running Whole December</p>
        </footer>

    </div>
    
    <div id="howItWorksModal" class="modal-backdrop">
      <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" data-translate="modalTitle">❓ How It Works: Challenge Details</h2>
        </div>
        
        <div class="modal-body">
            <h3 data-translate="modalTncHeader">General Terms & Conditions</h3>
            <p data-translate="modalTncBody">Participation is open to all registered users in the specified markets (BR/MX). Rankings are based purely on aggregated daily turnover. All times are based on UTC-6.</p>

            <h3 data-translate="modalFaqHeader">Frequently Asked Questions (FAQ)</h3>

            <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span data-translate="faq1Q">What is the Daily Turnover Challenge?</span><i class="fas fa-chevron-down"></i></div><div class="faq-answer"><p data-translate="faq1A">It's a daily competition where players are ranked based on their total turnover in USD equivalent within a 24-hour period (1:00 AM UTC-6 to 1:00 AM UTC-6 the next day).</p></div></div>
            <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span data-translate="faq2Q">How is Turnover calculated?</span><i class="fas fa-chevron-down"></i></div><div class="faq-answer"><p data-translate="faq2A">Turnover is the total amount wagered or traded by the user. It is converted to USD using the daily exchange rate determined at 1:00 AM UTC-6.</p></div></div>
            <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span data-translate="faq3Q">When is the Leaderboard updated?</span><i class="fas fa-chevron-down"></i></div><div class="faq-answer"><p data-translate="faq3A">The leaderboard is **manually updated every 30 minutes** throughout the day. The timer at the top reflects the approximate time until the next manual data refresh.</p></div></div>
            <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span data-translate="faq4Q">What are the prize tiers?</span><i class="fas fa-chevron-down"></i></div><div class="faq-answer"><p data-translate="faq4A1">Prizes are awarded daily based on the final ranking at the end of the 24-hour cycle:</p><ul data-translate="faq4A2"><li>Rank 1: USD 100</li><li>Rank 2: USD 50</li><li>Rank 3: USD 30</li><li>Rank 4-10: USD 20</li><li>Prizes are credited within 24 hours of the challenge end.</li></ul></div></div>
            <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span data-translate="faq5Q">How can I find my rank if I am not in the Top 20?</span><i class="fas fa-chevron-down"></i></div><div class="faq-answer"><p data-translate="faq5A">Use the **Username Search** bar above the leaderboard. If you enter your exact username, the system will pull your specific rank and turnover from the full dataset, even if you are ranked 50th.</p></div></div>
            <div style="text-align: right; margin-top: 20px;"><button class="cta-button cta-primary" onclick="closeModal()">Close Details</button></div>

        </div>
      </div>
    </div>
    
<script>
    // =======================================================
    // 1. CONFIGURATION (Gviz Method for Live Sync)
    // =======================================================
    const SHEET_ID = '1pnHNbmUETs4Mve_jVGENUiY8PEoaKWkc988tOdt3RA8';
    // GID is the ID of the specific sheet tab (0 is usually the first tab)
    const SHEET_GID = '0'; 
    const LEADERBOARD_API_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&tq&gid=${SHEET_GID}`;

    let fullLeaderboardData = []; 
    const DEFAULT_AVATAR = 'https://i.imgur.com/vH1WjYn.png'; 
    const FALLBACK_FLAG = 'https://i.imgur.com/4gS1s1j.png';
    
    // --- Translations (Keep your original translation data here) ---
    const translations = {
        'en': {
            // ... your English text ...
            'header_rank': 'Rank',
            'header_name': 'Username',
            'header_turnover': 'Turnover',
            'header_prize': 'Prize',
            'select_language': 'Select Language',
            'select_date': 'Select Date',
            'prize_usd': 'USD',
            'payout_in': 'Payout in',
            'update_in': 'Update in',
            // ...
        },
        'pt': {
            // ... your Portuguese text ...
            'header_rank': 'Classificação',
            'header_name': 'Usuário',
            'header_turnover': 'Volume de Negócios',
            'header_prize': 'Prêmio',
            'select_language': 'Selecione o Idioma',
            'select_date': 'Selecione a Data',
            'prize_usd': 'USD',
            'payout_in': 'Pagamento em',
            'update_in': 'Atualização em',
            // ...
        }
    };
    
    let currentLanguage = 'en';

    // =======================================================
    // 2. LIVE DATA FETCH AND PARSING FUNCTION
    // =======================================================

    async function fetchDataForDate(date) {
        const selectedDate = date || getTodayDateString(); 
        document.getElementById('leaderboardDate').value = selectedDate; 
        
        try {
            const response = await fetch(LEADERBOARD_API_URL);
            const text = await response.text();
            
            // Clean the JSONP wrapper (strips the outer garbage: /*O_o*/google.visualization.Query.setResponse( and the final );)
            const cleanText = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);

            const gvizData = JSON.parse(cleanText);
            
            // Extract headers (column labels) and rows
            const headers = gvizData.table.cols.map(col => col.label);
            const rawRows = gvizData.table.rows;
            
            fullLeaderboardData = rawRows.map(row => {
                const player = {};
                
                // Process each cell in the row
                row.c.forEach((cell, index) => {
                    const header = headers[index];
                    // Get the raw value (v) or the formatted value (f)
                    let value = cell ? (cell.f !== null && cell.f !== undefined ? cell.f : cell.v) : ''; 

                    // Map value to player object, handling types and fallbacks
                    if (header === 'Rank' || header === 'Turnover' || header === 'Prize') {
                         player[header] = parseInt(String(value).replace(/[^0-9]/g, '')) || 0;
                    } else if (header) {
                         player[header] = String(value || '');
                    }
                });
                
                // Ensure required fields exist with fallbacks
                player.Rank = player.Rank || 0;
                player.Name = player.Name || 'Unknown User';
                player.Turnover = player.Turnover || 0;
                player.Prize = player.Prize || 0;
                player.Country = player.Country || 'ZZ';
                player.AvatarURL = player.AvatarURL || DEFAULT_AVATAR;
                player.FlagURL = player.FlagURL || FALLBACK_FLAG; 

                return player;
            }).filter(player => player.Rank > 0); // Only keep rows with a valid Rank

            // Re-sort data by Rank to ensure display order is correct
            fullLeaderboardData.sort((a, b) => a.Rank - b.Rank); 

        } catch (error) {
            console.error("Error fetching leaderboard data from Google Sheet (Gviz):", error);
            // Optional: Implement a static fallback data load here if the API fails
            // fullLeaderboardData = getMockDataFallback(selectedDate); 
        }

        renderPodium(fullLeaderboardData.slice(0, 3));
        renderList(fullLeaderboardData);
        filterLeaderboard(); 
    }
    
    // =======================================================
    // 3. CORE LOGIC AND UTILITIES
    // =======================================================

    function getTodayDateString() {
        const today = new Date();
        const year = today.getFullYear();
        // Month and day need to be padded with zero if single digit
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    function getFlagUrl(player) {
        // Use the FlagURL read directly from the player object (from the sheet)
        return player.FlagURL || FALLBACK_FLAG; 
    }

    function getPrizeDisplay(prize) {
        if (prize > 0) {
            return `<div class="prize-tag"><span class="prize-amount">${prize}</span> <span class="prize-currency">${translations[currentLanguage].prize_usd}</span></div>`;
        }
        return '';
    }

    function formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }
    
    // ... (Your other utility functions like applyTranslations, startPayoutCountdown, startUpdateCountdown, etc.) ...
    
    // =======================================================
    // 4. RENDER FUNCTIONS (Adjusted to use the sheet data keys)
    // =======================================================

    function renderPodium(data) {
        const podiumData = [
            data.find(p => p.Rank === 2), // Rank 2 for the left
            data.find(p => p.Rank === 1), // Rank 1 for the center
            data.find(p => p.Rank === 3)  // Rank 3 for the right
        ].filter(p => p); // Filter out undefined if less than 3 players

        podiumData.forEach(player => {
            const rank = player.Rank;
            const rankMap = { 1: 'center', 2: 'left', 3: 'right' };
            const pos = rankMap[rank];
            
            document.getElementById(`avatar-${pos}`).src = player.AvatarURL;
            document.getElementById(`flag-${pos}`).src = getFlagUrl(player);
            document.getElementById(`name-${pos}`).textContent = player.Name;
            document.getElementById(`turnover-${pos}`).textContent = formatNumber(player.Turnover);
            document.getElementById(`prize-${pos}`).innerHTML = getPrizeDisplay(player.Prize);
        });
    }

    function renderList(data) {
        const listContainer = document.getElementById('leaderboard-list');
        listContainer.innerHTML = '';
        const listPlayers = data.filter(p => p.Rank >= 4 && p.Rank <= 50); // Display ranks 4 to 50

        listPlayers.forEach(player => {
            const listItem = document.createElement('li');
            listItem.className = 'list-item';

            listItem.innerHTML = `
                <div class="list-rank">${player.Rank}</div>
                <div class="list-player-info">
                    <img src="${player.AvatarURL}" class="avatar-list" alt="Avatar ${player.Name}">
                    <div class="list-name-flag">
                        <span class="list-name">${player.Name}</span>
                        <img src="${getFlagUrl(player)}" class="flag-icon" alt="Flag">
                    </div>
                </div>
                <div class="list-turnover">
                    ${formatNumber(player.Turnover)}
                </div>
                <div class="list-prize">
                    ${getPrizeDisplay(player.Prize)}
                </div>
            `;
            listContainer.appendChild(listItem);
        });
    }

    function filterLeaderboard() {
        // ... (Your existing filter logic remains the same, it uses fullLeaderboardData) ...
        // ... (Make sure it calls renderPodium and renderList with the filtered results) ...
    }

    // =======================================================
    // 5. INITIALIZATION AND AUTO-REFRESH
    // =======================================================

    document.addEventListener('DOMContentLoaded', async () => {
        // Initial load
        applyTranslations(currentLanguage);
        await fetchDataForDate(getTodayDateString()); 
        
        // Setup language selection listener
        document.getElementById('language-select').addEventListener('change', (e) => {
            currentLanguage = e.target.value;
            applyTranslations(currentLanguage);
            renderPodium(fullLeaderboardData.slice(0, 3)); // Re-render to update prize text
            renderList(fullLeaderboardData); // Re-render to update prize text
        });

        // Auto-refresh the leaderboard data every 60 seconds
        setInterval(() => {
             fetchDataForDate(getTodayDateString());
             console.log("Leaderboard data refreshed from Google Sheet.");
        }, 60000); // 60000 milliseconds = 1 minute

        startPayoutCountdown(); 
        startUpdateCountdown(); 
    });

</script>
</body>
</html>
